<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Texturas Seamless</title>
    <style>
        /* Estilos básicos para que se vea decente */
        body { font-family: sans-serif; background: #f0f0f0; display: flex; flex-direction: column; align-items: center; padding: 2em; }
        .container { background: white; padding: 2em; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); width: 80%; max-width: 900px; }
        h1 { text-align: center; }
        #uploader { border: 2px dashed #ccc; padding: 2em; text-align: center; cursor: pointer; }
        .previews { display: flex; justify-content: space-around; margin-top: 2em; }
        .preview-box { width: 45%; }
        img { max-width: 100%; border: 1px solid #ddd; }
        #loader { display: none; text-align: center; margin: 1em; }
        #download-link { display: none; text-align: center; margin-top: 1em; background: #28a745; color: white; padding: 10px 15px; text-decoration: none; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Generador de Texturas Seamless</h1>
        <input type="file" id="file-input" accept="image/*" style="display: none;">
        <div id="uploader" onclick="document.getElementById('file-input').click();">
            <p>Haz clic o arrastra una imagen aquí</p>
        </div>
        
        <div id="loader">
            <p>Procesando, por favor espera...</p>
        </div>

        <div class="previews">
            <div class="preview-box">
                <h2>Original</h2>
                <img id="preview-original" src="" alt="Vista previa de la imagen original">
            </div>
            <div class="preview-box">
                <h2>Resultado Seamless</h2>
                <img id="preview-result" src="" alt="Resultado de la textura seamless">
            </div>
        </div>
        <a id="download-link" href="#" download="textura_seamless.png">Descargar Resultado</a>
    </div>

    <script>
        const fileInput = document.getElementById('file-input');
        const previewOriginal = document.getElementById('preview-original');
        const previewResult = document.getElementById('preview-result');
        const loader = document.getElementById('loader');
        const downloadLink = document.getElementById('download-link');
        const uploader = document.getElementById('uploader');

        fileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (!file) return;

            // Mostrar la imagen original
            const reader = new FileReader();
            reader.onload = (e) => {
                previewOriginal.src = e.target.result;
            };
            reader.readAsDataURL(file);

            // Preparar y enviar la imagen al backend
            handleImageUpload(file);
        });

        async function handleImageUpload(file) {
            loader.style.display = 'block';
            downloadLink.style.display = 'none';
            previewResult.src = '';

            const formData = new FormData();
            formData.append('file', file);

            try {
                // La URL de nuestro backend
                const response = await fetch('http://127.0.0.1:8000/generate-seamless/', {
                    method: 'POST',
                    body: formData,
                });

                if (!response.ok) {
                    throw new Error('Error en el servidor: ' + response.statusText);
                }

                // El backend devuelve la imagen como un "blob"
                const imageBlob = await response.blob();
                const imageUrl = URL.createObjectURL(imageBlob);

                // Mostrar el resultado y el enlace de descarga
                previewResult.src = imageUrl;
                downloadLink.href = imageUrl;
                downloadLink.style.display = 'block';

            } catch (error) {
                console.error('Ocurrió un error:', error);
                alert('No se pudo procesar la imagen.');
            } finally {
                loader.style.display = 'none';
            }
        }
    </script>
</body>
</html>